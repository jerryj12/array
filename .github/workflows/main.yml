name: Deploy to Hostinger via FTP

on:
  workflow_dispatch:  # Enable manual execution

jobs:
  deploy:
    runs-on: ubuntu-latest

    env:
      DESTINATION_FOLDER: ${{ github.event.inputs.destination-folder }}
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v2

      - name: Set Up FTP
        run: |
          sudo apt-get -y install lftp
        env:
          FTP_SERVER: ${{ secrets.FTP_SERVER }}
          FTP_USER: ${{ secrets.FTP_USER }}
          FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}

      - name: Create ZIP Archive
        run: |
          # Add commands to create a ZIP archive of your build output
          zip -r my_code.zip build/
          # Replace with your actual build commands

      - name: Upload ZIP Archive to Hostinger via FTP
        run: |
          # Install the required tools if not already installed
          sudo apt-get -y install lftp

          # Create a script file to upload the ZIP archive via FTP
          echo "set ssl:check-hostname no" >> ftp_commands  # Disable hostname checking
          echo "open -u $FTP_USER,$FTP_PASSWORD $FTP_SERVER" >> ftp_commands
          echo "cd ~/$DESTINATION_FOLDER" >> ftp_commands  # Use the input parameter
          echo "put my_code.zip" >> ftp_commands    # Replace with your ZIP archive filename
          echo "bye" >> ftp_commands

          # Use lftp to execute the FTP commands from the script file
          lftp -f ftp_commands
        env:
          FTP_SERVER: ${{ secrets.FTP_SERVER }}
          FTP_USER: ${{ secrets.FTP_USER }}
          FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}
          DESTINATION_FOLDER: ${{ github.event.inputs.destination-folder }}
